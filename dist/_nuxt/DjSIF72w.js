import{X as y,r as c,G as u,Y as D}from"./CpzEDSKg.js";import{u as _}from"./vlyNUNmt.js";const $=y("user",()=>{const n=_(),{$toast:a}=D(),o=c(!1),s=c({}),f=e=>({...e,phone:e.phone?e.phone.slice(3):e.phone,region:e.region?e.region.id:e.region,district:e.district?e.district.id:null,school:e.school?e.school.id:null}),i=e=>{var t;const r=((t=e.response)==null?void 0:t.data)||{};r?Object.entries(r).forEach(([g,d])=>{a.error(`${g}: ${d.join(", ")}`)}):a.error(e.message||"Aniq xatolik haqida ma'lumot yo'q")},l=async()=>{o.value=!0;try{const e=await n.get("users/profile/");s.value=f(e)}catch(e){i(e)}finally{o.value=!1}},m=()=>{const e=new FormData;return Object.entries(s.value).forEach(([r,t])=>{t!=null&&(r==="phone"?e.append(r,"998"+t):e.append(r,t))}),e},p=async()=>{o.value=!0;const e=m();console.log(e);try{const r=await n.patch("users/profile/",e);await l(),a.success("Profil muvaffaqiyatli o`zgartirildi")}catch(r){i(r)}finally{o.value=!1}},h=u(()=>`${s.value.last_name||""} ${s.value.first_name||""}`.trim()),v=u(()=>{const e=s.value.first_name?s.value.first_name.charAt(0):"",r=s.value.last_name?s.value.last_name.charAt(0):"";return e+r});return{user:s,loading:o,fullName:h,fullNameInitial:v,fetchUser:l,updateUserProfile:p}});export{$ as u};
