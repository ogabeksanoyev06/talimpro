import{X as m,n as c,Q as y,r as v,G as k,Y as z}from"./D6umD6EU.js";import{u as w}from"./CucEvqX1.js";const T=m("auth",()=>{const o=w(),{$toast:r}=z(),n=c("access_token"),i=c("refresh_token"),u=y(),t=v(!1),p=async e=>{t.value=!0;try{const s=await o.post("users/login/",e);n.value=s.access,i.value=s.refresh,u.push("/"),r.success("Tizimga muvaffaqiyatli kirdingiz!")}catch(s){r.error(s.response.data.detail||"Login xatoligi")}finally{t.value=!1}},d=async(e,s)=>{t.value=!0;try{const a=await o.post("users/register/",{phone:"998"+e.phone,first_name:e.firstname,last_name:e.lastname,username:e.username,password:e.password,type:s});a&&parseInt(a.code)===201&&(u.push("/auth/login"),r.success("Ro'yxatdan muvaffaqiyatli o'tdingiz!"))}catch(a){let l="Xatolik yuz berdi. Iltimos, qaytadan urinib ko'ring.";if(a.response&&a.response.data&&a.response.data.result&&a.response.data.result.errors){const h=a.response.data.result.errors;l=Object.values(h).flat().join(" ")}r.error(l)}finally{t.value=!1}},f=async e=>{t.value=!0;try{(await o.post("users/reset-password/",e)).code===200&&r.success("Parol muvaffaqiyatli o'zgartirildi")}catch(s){r.error(s.response.data.detail||"Xatolik yuz berdi")}finally{t.value=!1}},g=k(()=>!!n.value&&!!i.value);return{login:p,register:d,resetPassword:f,logout:()=>{n.value=null,i.value=null,u.push("/auth/login"),r.success("Tizimdan chiqdingiz")},isAuthenticated:g}});export{T as u};
